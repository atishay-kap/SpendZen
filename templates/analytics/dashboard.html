{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto p-6 space-y-6">
  <h1 class="text-2xl font-semibold">Dashboard</h1>

  <div class="grid md:grid-cols-2 gap-6">
    <!-- Category Chart -->
    <div class="p-4 rounded-xl border">
      <h2 class="font-medium mb-2">Expenses by Category</h2>
      <canvas id="catChart"></canvas>
    </div>

    <!-- Monthly Totals -->
    <div class="p-4 rounded-xl border">
      <h2 class="font-medium mb-2">Expenses by Month</h2>
      <canvas id="monthChart"></canvas>
    </div>
  </div>

  <!-- Daily Cumulative -->
  <div class="p-4 rounded-xl border">
    <h2 class="font-medium mb-2">Daily Cumulative (Current Month)</h2>
    <canvas id="dailyChart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Category chart
fetch("{% url 'expenses_by_category' %}")
  .then(res => res.json())
  .then(data => {
    const labels = data.map(x => x.category__name || "Uncategorized");
    const values = data.map(x => x.total);
    new Chart(document.getElementById("catChart"), {
      type: "doughnut",
      data: { 
        labels, 
        datasets: [{
          label: "Expenses by Category",
          data: values 
        }] 
      }
    });
  });

// Monthly totals (bar chart)
fetch("{% url 'expenses_by_month' %}")
  .then(res => res.json())
  .then(data => {
    const labels = data.map(x => new Date(x.month).toLocaleDateString("en-US", { month: "short", year: "numeric" }));
    const values = data.map(x => x.total);
    new Chart(document.getElementById("monthChart"), {
      type: "bar",
      data: { 
        labels, 
        datasets: [{
          label: "Monthly Total",
          data: values 
        }] 
      },
      options: {
        scales: {
          x: { title: { display: true, text: "Month" } },
          y: { title: { display: true, text: "Amount" } }
        }
      }
    });
  });

// Daily cumulative (line chart)
fetch("{% url 'daily_cumulative_expenses' %}")
  .then(res => res.json())
  .then(data => {
    const labels = data.map(x => new Date(x.day).toLocaleDateString("en-US", { month: "short", day: "numeric" }));
    const values = data.map(x => x.total);
    new Chart(document.getElementById("dailyChart"), {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Cumulative Spending",
          data: values,
          fill: true
        }]
      },
      options: {
        scales: {
          x: { title: { display: true, text: "Day" } },
          y: { title: { display: true, text: "Amount" } }
        }
      }
    });
  });
</script>
{% endblock %}
